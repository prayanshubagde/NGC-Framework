# Module Specification: M2 - PSMSL (φ-Scaled Mirrored Semantic Lattice)

**Version:** 1.0  
**Status:** DRAFT  
**Author:** Nathanael J. Bocker  
**Date:** January 18, 2026

---

## 1. Purpose

This module serves as the **relational processing engine** of the AGI architecture. Its primary responsibility is to maintain a real-time model of the relationships between all concepts in a given context, to calculate diagnostic metrics based on that model, and to detect significant changes in the system's structure (phase transitions).

## 2. Dependencies

-   **M1 (NGC):** This module requires the NGC module to validate its geometric operations and to access fundamental constants like `phi`.

## 3. Core Data Structures

-   **Covariance Matrix (N x N):** A floating-point matrix where N is the number of concepts being tracked. `Matrix[i][j]` stores the instantaneous covariance between concept `i` and concept `j`. This is the core data structure representing the system's state.
-   **Concept List (Array of Strings):** An array of N strings that maps the indices of the covariance matrix to human-readable concept names.
-   **Diagnostic State (Object):** An object storing the latest calculated values for the Leibniz-Bocker diagnostics: `{ rho, omega, r_squared }`.

## 4. API Specification

### `init_lattice(concepts)`

-   **Description:** Initializes a new semantic lattice for a given set of concepts.
-   **Inputs:**
    -   `concepts` (Array of Strings): A list of unique concept names to track (e.g., `["price", "volume", "volatility"]`).
-   **Outputs:**
    -   `Boolean`: `true` on successful initialization.
-   **Side Effects:** Creates an N x N covariance matrix in memory, initialized to the identity matrix.
-   **Error Handling:**
    -   Throws `InitializationError` if the lattice is already initialized.
    -   Throws `InvalidInputError` if `concepts` is not a non-empty array of unique strings.

### `update_state(vectors)`

-   **Description:** Updates the covariance matrix with new data and recalculates the system diagnostics.
-   **Inputs:**
    -   `vectors` (Array of Arrays): An array of N 3D vectors, where `vectors[i]` corresponds to the new geometric state of `concepts[i]`.
-   **Outputs:**
    -   `Object`: The new diagnostic state: `{ rho, omega, r_squared }`.
-   **Side Effects:** Modifies the internal covariance matrix and diagnostic state.
-   **Error Handling:**
    -   Throws `StateError` if the lattice is not initialized.
    -   Throws `DimensionMismatchError` if the input vector count does not match the number of concepts.

### `get_diagnostics()`

-   **Description:** Returns the most recently calculated diagnostic state of the system.
-   **Inputs:** None.
-   **Outputs:**
    -   `Object`: The current diagnostic state: `{ rho, omega, r_squared }`.
-   **Error Handling:**
    -   Throws `StateError` if the lattice has not been updated at least once.

### `get_phase_transition_alert()`

-   **Description:** Checks if the most recent state update triggered a phase transition event.
-   **Inputs:** None.
-   **Outputs:**
    -   `Object` or `null`: If a transition occurred, returns an object with details: `{ from_state: {...}, to_state: {...}, magnitude: float }`. Otherwise, returns `null`.
-   **Error Handling:**
    -   Throws `StateError` if the lattice has not been updated at least once.

## 5. Performance Benchmarks

-   `init_lattice`: **O(N²)** due to matrix allocation.
-   `update_state`: **O(N²)** for covariance matrix update and diagnostic calculations.
-   `get_diagnostics`: **O(1)**.
-   `get_phase_transition_alert`: **O(1)**.

For N=200 concepts, `update_state` is expected to execute in under 10 milliseconds on a standard CPU, enabling real-time performance.

---

**© Nathanael J. Bocker, 2026. All rights reserved.**
